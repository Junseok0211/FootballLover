{% extends 'base.html' %}

{% load static %}
{% load hDate %}

{% block contents %}
<!-- // jQuery UI CSS파일  -->
<link rel="stylesheet" href="http://code.jquery.com/ui/1.8.18/themes/base/jquery-ui.css" type="text/css" />  
<!-- // jQuery 기본 js파일 -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>  
<!-- // jQuery UI 라이브러리 js파일 -->
<script src="http://code.jquery.com/ui/1.8.18/jquery-ui.min.js"></script>  
<!-- <link rel="stylesheet" href="{% static 'css/match2.css' %}"> -->
<script src="{% static 'account/js/register.js' %}" type="text/javascript"></script>
<style>
ul,
li,
figure,
h3,
h4,
p {
    margin: 0;
    padding: 0;
    list-style: none;
}
.sec * {
    font-family: "Noto Sans KR", sans-serif;
}
i {
    font-family: "Font Awesome 5 Pro" !important;
}

/* 공통 - 양쪽정렬된 탭 메뉴 */
.nav-justified {
    display: flex;
    flex-direction: row;
    align-items: center;
    font-weight: bold;
    box-sizing: content-box;
    font-size: 0.75rem;
    color: #8c8c8c;
    background: #e1e1e1;
    border-radius: 2px;
}
.nav-justified > .item {
    position: relative;
    box-sizing: content-box;
    padding: 0.7rem 0rem;
    text-align: center;
    width:25%;
}
.nav-justified > .item.active {
    color: #131313;
}
.nav-justified > .item.active::after {
    content: "";
    position: absolute;
    left: 0;
    bottom: 0;
    width: 100%;
    height: 4px;
    background-color: #131313;
}

/* 공통 - 프로필이미지 */
.thumb-profile {
    display: flex;
    align-items: center;
    font-size: 0.625rem;
    color: #131313;
}

.thumb-profile > figure {
    margin-right: 0.5rem;
    width: 1.875rem;
    height: 1.875rem;
    border-radius: 100%;
    background: #f1f1f1 url("https://footballlover.s3.amazonaws.com/static/onlyLogo.png") no-repeat;
    background-position: center;
    background-size: cover;
}

/* 공통 - 버튼그룹 */
.btn-wrap {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.btn-wrap .btn {
    padding: 0;
    width: calc(50% - 0.25rem);
    height: 3rem;
    line-height: 3rem;
    font-weight: bold;
    font-size: 1rem;
    color: #fff;
    border-radius: 3px;
}
.btn-wrap .btn.block {
    width: 100%;
}

.btn-wrap .btn.active {
    background-color: #28aae3 !important;
}

/* 플레이 */
.sec.play {
    padding: 5.3rem 3.5rem;
    background: url("{% static 'bg_play.png' %}") no-repeat;
    background-position: center;
    background-size: cover;
}
.sec.play .list {
    display: flex;
    align-items: center;
    height: 3.375rem;
    line-height: 3.375rem;
    margin-bottom: 2.5rem;
    background-color: #333333;
    box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25);
}
.sec.play .list figure {
    display: block;
    margin: -4px 1rem 0 0;
    height: 100%;
}
.sec.play .list .tit {
    padding: 1rem 0;
    font-weight: bold;
    font-size: 1.125rem;
    color: #ffffff;
}

/* 개인매칭 */
.sec.match {
    padding: 0.5rem 1rem 1rem;
}
.sec.match .btn-wrap .btn {
    background-color: #ffb229;
}

/* 개인매칭-디테일 */
.matchDetial .head {
    background-color: #eeeeee;
    border-radius: 2px;
}

.matchDetial .head > .tit {
    padding: 0.5rem;
    font-weight: bold;
    font-size: 0.75rem;
    color: #8c8c8c;
}

.matchDetial.place .head {
    margin: 0.5rem 0;
    background-color: #28aae3;
}

.matchDetial.place .head > .tit {
    color: #fff;
}

.matchDetial .detail_list > .item {
    display: flex;
    align-items: center;
    padding: 0.5rem;
    font-weight: bold;
    font-size: 0.875rem;
    color: #131313;
    border-top: solid 1px #e1e1e1;
    box-sizing: border-box;
}

.matchDetial .detail_list > .item figure {
    margin-right: 2rem;
    width: 1.6rem;
    height: 1.6rem;
    background: #fff url("https://footballlover.s3.amazonaws.com/static/onlyLogo.png") no-repeat;
    background-size: 100%;
    background-position: center;
}

.matchDetial .detail_list > .item.person {
    padding: 0.75rem 0;
    margin-bottom: 0.5rem;
    height: auto;
    line-height: normal;
    font-weight: normal;
    border-bottom: solid 1px #e1e1e1;
}

.matchDetial .detail_list > .item.person figure {
    margin-right: 1rem;
    width: 3.125rem;
    height: 3.12rem;
}

.matchDetial .detail_list > .item.person .txt.point {
    font-weight: 500;
    font-size: 0.75rem;
}

.matchDetial.people .cont {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: space-around;
    padding: 0.75rem 0 1rem;
    margin-bottom: 1rem;
}

.matchDetial.people .cont::before {
    content: "";
    position: absolute;
    left: -1rem;
    bottom: 0;
    width: calc(100% + 2rem);
    height: 1px;
    background-color: #f5f5f5;
}

/* 개인매치 글쓰기 */

.match-form {
    padding: 1.2rem 0 2rem;
    text-align: center;
}

.match-form .item {
    padding: 0.5rem 0;
    border-bottom: solid 1px #eeeeee;
    box-sizing: border-box;
}
.match-form .item.last {
    border: none;
}

.match-form label {
    display: block;
    font-weight: bold;
    font-size: 0.6875rem;
    color: #28aae3;
}

.match-form .group {
    display: flex;
    align-items: center;
    justify-content: space-evenly;
    border-bottom: solid 1px #eeeeee;
    box-sizing: border-box;
    overflow: hidden;
}

.match-form .group .line {
    display: inline-block;
    left: 50%;
    top: 0;
    width: 1px;
    height: 50px;
    background-color: #eee;
    transform: rotate(20deg);
}

.match-form .select {
    position: relative;
    display: inline-block;
    padding: 0;
    width: auto;
}

.match-form .select::before {
    /* content: "\f0dc"; */

    position: absolute;
    right: 11px;
    top: 0px;
    font: normal normal normal 14px/1 FontAwesome;
    height: 100%;
    padding: 14px 0px 0px 8px;
    pointer-events: none;
}

.selectException{
    position: relative;
    display: inline-block;
    padding: 0;
    width: auto;
    border: none;
    text-align: center;
    text-align-last: center;
    font-size: 1rem;
    font-weight: bold;
}

.match-form select,
.match-form input {
    border: none;
    text-align: center;
    text-align-last: center;
    font-size: 1rem;
    font-weight: bold;
}

.match-form textarea {
    min-height: 180px;
    border: 1px solid #eeeeee;
    box-sizing: border-box;
    border-radius: 0;
    font-size: 0.75rem;
    color: #8c8c8c;
}

.scroll-selected-time {
    display: flex;
    overflow-x: auto;
    margin-top: 0.75rem;
}

.scroll-selected-time .time {
    margin-right: 1px;
    min-width: 60px;
    height: 3.125rem;
    line-height: 3.125rem;
    font-weight: bold;
    font-size: 0.625rem;
    color: #8c8c8c;
    text-align: center;
    background-color: #eeeeee;
}

.scroll-selected-time .time.active {
    color: #28aae3;
}

.navBar{
    background-color: #F3F3F3;
    height: 60px;
    width: 100%;
    position: fixed;
    top: 0;
    z-index: 1;
    
}


.navDesign{
    max-width: 720px;
    width: 100%;
    padding:10px;
    margin:0 auto;
    display: flex;
    justify-content: space-between;
}
    .marginForNav{
        margin-top: 80px;
    }

    .pc{
        display: block;
    }

    .mobile{
        display: none;
    }

    @media all and (max-device-width : 720px) {
    .pc{
        display: none;
    }
    .mobile{
        display: block;
    }
    .marginForNav{
        margin-top: 60px;
    }

}

</style>
{% if error %}
<script>
    alert("{{error}}");
</script>
{% endif %}
<div class="mobile">
    <!--navBar -->
    <nav class="navBar">
        <div class="navDesign">
            <div>
                <a href="{% url 'tIsReserved' %}" style="color: gray; margin-top: 0.5rem;">
                    <i class="fas fa-lg fa-chevron-left" style="margin-top: 12px;"></i>
                </a>
            </div>
            <div style="margin-top: 5px;">
                <span style="font-family: 'Noto Sans KR'; font-weight: bold; font-size: 1.2rem;">팀매칭</span>
            </div>
            <div>
            </div>
        
        </div>
    </nav>
    <!--navBar 끝--> 
</div>

<span class="pc">
{% include 'pcNavBar.html' %}
</span>

<!--컨텐츠 영역-->
<div class="marginForNav">
<div class="sec match" style="max-width: 720px; width: 100%; margin:0 auto;">
    <!-- 양쪽정렬된 탭 메뉴 -->
    <ul class="nav-justified">
        <li class="item">
            <p class="txt">
                <a href = "{% url 'personal' %}" style="text-decoration: none; color: #8c8c8c;">
                    개인 매칭
                </a>
            </p>
        </li>
        <li class="item active">
            <p class="txt">
                <a href = "{% url 'teamMatching' %}" style="text-decoration: none; color:#131313;">
                    팀 매칭
                </a>
            </p>
        </li>
        <li class="item">
            <p class="txt">
                <a href = "{% url 'recruiting' %}" style="text-decoration: none; color:#8c8c8c;">
                    용병 매칭
                </a>
            </p>
        </li>
        <li class="item">
            <p class="txt">
                <a href = "{% url 'league' %}" style="text-decoration: none; color:#8c8c8c;">
                    풋살데이
                </a>
            </p>
        </li>
    </ul>
    
<form name = "register" method="POST" action="{% url 'tPartnerCreate' %}" enctype="multipart/form-data" 
    autocomplete="off" onsubmit="return formCheck(this);">
    {% csrf_token %}
    <div class="match-form" id="matchForm">
        <div id="playTime">
            <input type='hidden' name = 'playTime' id='reservationTime' />
        </div>
        <div class="item">
            <label for="message">실력</label>
            <div class="select">
                <select class="form-control" name="rank">
                    <option disabled selected value="rank">선택</option>
                    <option value="프로">프로</option>
                    <option value="세미프로">세미프로</option>
                    <option value="아마추어">아마추어</option>
                    <option value="비기너">비기너</option>
                </select>
            </div>
        </div>
        <div class="item">
            <label for="message">팀 참가비</label>
            <div class="select">
                <input type="number" class="form-control" name="joinFee" placeholder="참가비">
            </div>
        </div>
        <div class="item">
            <label for="message">내용</label>
            <div class="">
                <textarea type="number" name="content"
                class="form-control" placeholder="내용을 입력하세요."></textarea>
            </div>
        </div>
    </div>

    <div class="btn-wrap">
        <input type="hidden" name="maxTime" value="{{maxTime}}">
        <input type="hidden" name="minTime" value="{{minTime}}">
        <input type="hidden" name="playground" value="{{playground}}">
        <input type="hidden" name="reservationDate" value="{{reservationDate}}">
        <button type="submit" class="btn active block">작성하기</button>
    </div>
</form>
</div>
</div>
<!--컨텐츠 영역-->

<footer class="mobile">
    {% include 'playFooter.html' %}
</footer>
<script type="text/javascript">
    var timeArray = [];

    function formCheck(frm){
      
        if(frm.rank.value == 'rank'){
            alert("실력을 선택해주세요.");
            frm.rank.focus();
            return false;
        }
        else if(frm.joinFee.value == ""){
            alert("참가비를 선택해주세요.");
            frm.joinFee.focus();
            return false;
        }
        else if(frm.content.value == ""){
            alert("내용을 입력해주세요.");
            frm.content.focus();
            return false;
        }
        return true;

    }

    $.datepicker.setDefaults({
        dateFormat: 'yy년 mm월 dd일 (DD)',
        prevText: '이전 달',
        nextText: '다음 달',
        monthNames: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
        monthNamesShort: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
        dayNames: ['일', '월', '화', '수', '목', '금', '토'],
        dayNamesShort: ['일', '월', '화', '수', '목', '금', '토'],
        dayNamesMin: ['일', '월', '화', '수', '목', '금', '토'],
        showMonthAfterYear: true,
        yearSuffix: '년'
    });

    $(function () {
        //조회 날짜 선택
        $("#origin_playDate").datepicker();

        //조회 시간 선택
        $(".scroll-selected-time .time").on("click", function () {
            
            let time = Number($(this).val());
            var timeLength = $('#scrollTime').children('.active').length;
            var firstTime = Number($('#scrollTime').children('.active').first().val());
            var lastTime = Number($('#scrollTime').children('.active').last().val());
            var preTimeDifference = firstTime - time;
            var postTimeDifference = time - lastTime;
            if(timeLength == 0){
                $(this).addClass("active").siblings().removeClass("active"); 
                timeArray.push(time);   
            }
            else if(timeLength == 1){
                if(preTimeDifference == 1 || preTimeDifference== -1 ){
                    $(this).addClass("active");  
                    timeArray.push(time);  
                }else if(preTimeDifference > 1 || preTimeDifference < -1){
                    alert('연속된 시간을 선택해주세요.');
                }else{
                    $(this).removeClass("active");
                    var index = timeArray.indexOf(time);
                    timeArray.splice(index,1);
                }
            }
            else{
                if(firstTime < time && time < lastTime){
                    alert('중간 시간을 취소할 수 없습니다.');
                }
                else if(firstTime > time){
                    if(preTimeDifference == 1){
                        $(this).addClass("active");  
                        timeArray.push(time);  
                    }else if(preTimeDifference > 1){
                        alert('연속된 시간을 선택해주세요.');
                    }else{
                        $(this).removeClass("active");
                        var index = timeArray.indexOf(time);
                        timeArray.splice(index,1);
                    }
                }
                else if(lastTime < time){
                    if(postTimeDifference == 1){
                        $(this).addClass("active"); 
                        timeArray.push(time);   
                    }else if(postTimeDifference > 1){
                        alert('연속된 시간을 선택해주세요.');
                    }else{
                        $(this).removeClass("active");
                        var index = timeArray.indexOf(time);
                        timeArray.splice(index,1);
                    }
                }
                else{
                    $(this).removeClass("active");
                    var index = timeArray.indexOf(time);
                    timeArray.splice(index,1);
                }
            }      
        })

    });
    function objLength(obj){
        var i=0;
        for (var x in obj){
            if(obj.hasOwnProperty(x)){
            i++;
            }
        } 
        return i;
    }

    function selectCity(obj){
        $.ajax({
            url: "{% url 'selectCity' %}",
            type:"GET",
            data : {'city':obj},
            dataType : "json",
            success: function(data){
                var ground = JSON.parse(data);
                var tag = "<option selected disabled hidden value='location'>선택</label>"
                for(i=0; i<objLength(ground.possibleGround); i++){
                    console.log(ground.possibleGround[i][0]);
                    console.log(ground.possibleGround[i][1]);
                    var groundId = ground.possibleGround[i][0];
                    var groundName = ground.possibleGround[i][1];
                    tag += "<option value='"+ groundId + "," + groundName + "'>" + groundName +"</option>";
                    
                }
                for(i=0; i<objLength(ground.impossibleGround); i++){
                    console.log(ground.impossibleGround[i][0]);
                    console.log(ground.impossibleGround[i][1]);
                    var groundId = ground.impossibleGround[i][0];
                    var groundName = ground.impossibleGround[i][1];
                    tag += "<option value='"+ groundId + "," + groundName + "'>" + groundName +"</option>";
                    
                }

                if(objLength(ground.impossibleGround) == 0 && objLength(ground.possibleGround) == 0){
                    tag = "<option value='playground'>등록구장 없음</option>";
                }
                $('#location').html(tag);
            }
        });
    };

</script>

{% endblock %}